# **催收人員行為儀表板 \- 開發歷程總結報告**

**專案目標：** 打造一個數據驅動、視覺化的管理工具，以追蹤、分析並優化催收人員的外訪行為模式與績效。

**核心技術棧：** Python, Streamlit, Pandas, Plotly

### **第一階段：概念驗證與原型設計 (Concept & Prototyping)**

* **需求起點：** 將 KH\_DM\_COLL\_REPOSN\_VISIT 的外訪紀錄數據化，透過日曆與週曆視圖，結合團隊與人員篩選，實現對催收員日常工作的基本追蹤。核心需求是能夠點擊案件卡片，查看詳細的催收摘要 (Contact Summary)。  
* **交付成果 V1 (HTML/JS 原型)：**  
  * 為快速驗證核心功能，我們首先交付了一個獨立的 HTML 檔案。  
  * 此原型整合了 Tailwind CSS 進行介面美化，並利用 PapaParse.js 在瀏覽器端直接解析使用者上傳的 CSV 檔案。  
  * **策略價值：** 這個輕量級原型成功地驗證了核心需求的技術可行性，並提供了一個可立即操作的初步模型，為後續的深度開發奠定了使用者體驗的基礎。

### **第二階段：技術棧轉移與本地化部署 (Technology Pivot & Localization)**

* **需求演進：** 為整合更複雜的數據分析能力並確保數據安全，您提出將儀表板從網頁版轉移至本地端，使用 Python 與 Streamlit 框架進行開發。  
* **交付成果 V2 (Streamlit 本地版)：**  
  * **V2.0 \- 檔案上傳版：** 開發了第一個 dashboard.py 腳本。此版本使用 st.file\_uploader 讓使用者手動上傳 Excel 檔案，並成功在本地環境中復現了原型機的所有核心功能。  
  * **V2.1 \- 路徑自動化版：** 根據您提供的本地檔案路徑，我們移除了手動上傳的步驟，將資料來源直接硬式編碼至腳本中，並導入 openpyxl 套件以支援 .xlsx 格式的讀取。這是邁向自動化工作流程的關鍵一步。

### **第三階段：數據清洗與邏輯健壯性強化 (Data Cleansing & Logic Fortification)**

在此階段，我們遭遇了真實世界數據的挑戰，並透過一系列的迭代，大幅提升了儀表板的穩定性與數據準確性。

* **挑戰 1：日期格式解析錯誤**  
  * **現象：** 儀表板僅顯示部分日期 (如 8/7, 7/8) 的紀錄。  
  * **診斷：** pandas 預設以美式 MM/DD/YYYY 格式解析日期，導致與資料源的 DD/MM/YYYY 格式衝突。  
  * **解決方案：** 在 pd.to\_datetime() 函式中，強制指定 format='%d/%m/%Y %H:%M:%S'，確保日期解析的精準性。  
* **挑戰 2：數據雜訊過濾**  
  * **需求：** 為確保分析的有效性，需排除兩類數據：1) 不在「分組名單」內的催收員紀錄；2) Neg Pos Unit 狀態為 CancelRepossession 的系統自動紀錄。  
  * **解決方案：** 在 load\_data 函式中，增加了兩道過濾程序，在數據加載的初始階段即完成清洗。  
* **挑戰 3：關鍵值匹配邏輯失效**  
  * **現象：** 更新「分組名單」後，儀表板顯示為空。  
  * **診斷：** 外訪紀錄的 Collector 欄位格式為 ID-姓名，而分組名單的關鍵欄位為純 ID，導致無法匹配。  
  * **解決方案：** 建立一個新的 Collector ID 欄位，從外訪紀錄中智慧提取出 ID 部分，並將後續所有的數據匹配與關聯操作，全部基於這個標準化的 Collector ID 進行。  
* **挑戰 4：環境編碼與UI衝突**  
  * **現象：** 月視圖因中文「年」導致 UnicodeEncodeError；月曆的下鑽功能導致 StreamlitAPIException。  
  * **解決方案：** 1\) 使用 f-string 格式化日期標題以規避系統編碼問題；2) 採用 Streamlit 官方推薦的**回呼函式 (Callback)** 機制重構下鑽功能，解決了狀態管理衝突。  
* **挑戰 5：框架版本兼容性與元件衝突 (新增)**  
  * **現象：** 出現 AttributeError (experimental\_rerun 不存在) 與 StreamlitDuplicateElementException (圖表元件重複) 的錯誤。  
  * **診斷：** 1\) 使用者端的 Streamlit 版本較新，已棄用舊版函式；2) 動態生成的圖表元件缺少唯一的識別碼。  
  * **解決方案：** 1\) 全面將 st.experimental\_rerun() 更新為新版的 st.rerun()；2) 為每一個 st.plotly\_chart() 元件添加了獨一無二的 key 參數，確保渲染的穩定性。

### **第四階段：從追蹤到分析——功能模塊的戰略升級 (Strategic Upgrade: From Tracking to Analytics)**

這是儀表板從一個「紀錄檢視工具」進化為「管理決策中心」的轉捩點。

* **功能演進 1：月視圖 \-\> 績效熱力圖**  
  * **需求：** 將月視圖改造為一個能宏觀展示工作強度的熱力圖，並具備下鑽至週視圖的互動能力。  
  * **交付成果：** 重構了月視圖，每日的格子根據案件數量顯示由淺至深的顏色，並可點擊「檢視」按鈕無縫切換至對應的週視圖，實現了從宏觀趨勢到微觀細節的分析路徑。  
* **功能演進 2：週視圖 \-\> 風險視覺化**  
  * **需求：** 在週視圖的案件卡片上，根據 Aging (M2-M6+) 的嚴重程度，用不同顏色進行風險預警。  
  * **交付成果：** 建立了雙層風險色系。卡片左側邊框使用高飽和度的警示色，背景則使用對應的淡彩版，在有效傳達風險等級的同時，確保了介面的清晰度與美感。  
* **功能演進 3：新增「個人績效」模塊**  
  * **需求：** 導入**維度一**分析，聚焦於個人的案件處理結構。  
  * **交付成果：** 新增了「個人績效」頁籤，利用 Plotly 套件，根據使用者自訂的日期範圍，生成互動式的圓餅圖與長條圖，深度剖析催收員在各帳齡案件上的分佈佔比與處理數量。  
* **功能演進 4：重構「團隊比較」 \-\> 「行為模式比較」**  
  * **需求：** 您提出原有的團隊比較不夠靈活，希望能實現**指定個人**與\*\*自訂參照組（平均值）\*\*的精準對標。  
  * **交付成果：** 這是儀表板的**核心價值升級**。我們移除了原模塊，創建了全新的「行為模式比較」頁籤。此功能允許您：  
    1. 選擇一位「基準對象」。  
    2. 複選多位成員組成「參照組」。  
    3. 在並列的儀表板中，直觀比較「基準對象」的個人表現與「參照組」的平均表現。  
* **功能演進 5：導入「情境感知」篩選**  
  * **需求：** 解決比較模塊中催收員列表過長、難以選擇的問題。  
  * **交付成果：** 為比較模塊的選擇器建立了與側邊欄篩選器的**智慧聯動**。當選擇特定團隊時，列表自動過濾為團隊內成員；當選擇所有團隊時，列表中的每個成員前會標註其所屬團隊，完美兼顧了**團隊內精準對標**與**跨團隊宏觀比較**的需求。  
* **功能演進 6：風險視覺語言精煉 (新增)**  
  * **需求：** M4, M5, M6 的風險顏色在視覺上區分度不足。  
  * **交付成果：** 重構了風險色系，在高風險區間引入了更飽和的橘色、深紅色，並為最高風險的 M6+ 案件導入了全新的**紫色系**，極大地增強了高風險案件的視覺突顯度與預警效果。

**總結：**

這個專案是「敏捷開發」與「需求驅動創新」的典範。我們從一個輕量級原型出發，透過持續的溝通與迭代，不僅解決了數據層面的各種挑戰，更在功能上完成了從\*\*「行為紀錄」**到**「績效剖析」**，再到**「對標分析」**的三級跳。最終的成品，已不僅是一個追蹤工具，而是一個能夠賦能管理決策、挖掘個人潛力、優化團隊資源配置的**戰略級數據產品\*\*。